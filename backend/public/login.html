<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - Agri E-Commerce</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <style>
      body {
        background: url("./Images/img1.jpg") no-repeat center center/cover;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .glass-card {
        backdrop-filter: blur(12px);
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 1rem;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        padding: 2rem;
        width: 380px;
        text-align: center;
      }
      .glass-input {
        background: rgba(255, 255, 255, 0.85);
        border: none;
        border-radius: 0.5rem;
        padding: 0.75rem;
      }
      .glass-input:focus {
        outline: none;
        box-shadow: 0 0 0 0.25rem rgba(25, 135, 84, 0.4);
      }
      .btn-green {
        background-color: #198754;
        border: none;
      }
      .btn-green:hover {
        background-color: #157347;
      }
    </style>
  </head>

  <body>
    <!-- Glass Card Login Form -->
    <div class="glass-card text-white">
      <h2 class="fw-bold text-success mb-4">Agri Ecom</h2>

      <form id="loginForm" class="d-grid gap-3">
        <input
          type="text"
          id="loginUsername"
          placeholder="Username"
          class="form-control glass-input"
          required
        />
        <input
          type="password"
          id="loginPassword"
          placeholder="Password"
          class="form-control glass-input"
          required
        />
        <button type="submit" class="btn btn-green text-white fw-semibold py-2">
          Login
        </button>
      </form>

      <p class="mt-4 text-light">
        Don't have an account?
        <a
          href="signup.html"
          class="text-success fw-semibold text-decoration-underline"
          >Sign Up</a
        >
      </p>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      document
        .getElementById("loginForm")
        .addEventListener("submit", async function (event) {
          event.preventDefault();

          const username = document
            .getElementById("loginUsername")
            .value.trim();
          const password = document
            .getElementById("loginPassword")
            .value.trim();

          if (username.length < 3) {
            alert("Username must be at least 3 characters.");
            return;
          }
          if (password.length < 6) {
            alert("Password must be at least 6 characters.");
            return;
          }

          try {
            const res = await fetch("http://localhost:5000/api/auth/login", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ username, password }),
            });

            const data = await res.json();

            if (!res.ok) {
              alert(data.msg || "Login failed!");
              return;
            }

            // âœ… Store all user details for later use
            localStorage.setItem("token", data.token);
            localStorage.setItem("username", data.user.username);
            localStorage.setItem("userId", data.user.id); // ðŸ”¥ REQUIRED for cart
            localStorage.setItem(
              "profilePic",
              data.user.profilePic || "images/profile.png"
            );

            alert("Login successful!");
            window.location.href = "home.html";
          } catch (err) {
            console.error(err);
            alert("Error connecting to server.");
          }
        });
    </script>
  </body>
</html>
